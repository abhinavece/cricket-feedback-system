# Global configuration
global:
  imageRegistry: ""
  imagePullSecrets: []
  storageClass: ""

# Common configuration
imagePullSecrets:
  - name: ocir-creds

# Backend configuration
backend:
  enabled: true
  image:
    registry: phx.ocir.io
    repository: axkw6whnjncs/cricket-feedback-backend
    tag: "2026.01.31.56"
    pullPolicy: IfNotPresent
  replicaCount: 1
  
  service:
    type: ClusterIP
    port: 5001
    targetPort: 5001
  
  resources:
    limits:
      cpu: 500m
      memory: 512Mi
    requests:
      cpu: 250m
      memory: 256Mi
  
  env:
    - name: NODE_ENV
      value: "production"
    - name: PORT
      value: "5001"
    - name: MONGODB_URI
      valueFrom:
        secretKeyRef:
          name: cricket-secrets
          key: mongodb-uri
    - name: JWT_SECRET
      valueFrom:
        secretKeyRef:
          name: cricket-secrets
          key: jwt-secret
    - name: GOOGLE_CLIENT_ID
      valueFrom:
        secretKeyRef:
          name: cricket-secrets
          key: google-client-id
    - name: GOOGLE_CLIENT_SECRET
      valueFrom:
        secretKeyRef:
          name: cricket-secrets
          key: google-client-secret
    - name: ADMIN_PASSWORD
      valueFrom:
        secretKeyRef:
          name: cricket-secrets
          key: admin-password
    - name: WHATSAPP_ACCESS_TOKEN
      valueFrom:
        secretKeyRef:
          name: whatsapp-credentials
          key: WHATSAPP_ACCESS_TOKEN
    - name: WHATSAPP_PHONE_NUMBER_ID
      valueFrom:
        secretKeyRef:
          name: cricket-secrets
          key: whatsapp-phone-number-id
    - name: WHATSAPP_VERIFY_TOKEN
      valueFrom:
        secretKeyRef:
          name: cricket-secrets
          key: whatsapp-verify-token
    - name: AI_SERVICE_ENABLED
      value: "true"
    - name: FRONTEND_URL
      value: "https://app.cricsmart.in"
    # Feature Flags - Enable/disable new features
    # Set to "true" to enable, "false" to disable
    - name: FF_MULTI_TENANT
      value: "true"
    - name: FF_TEAM_DISCOVERY
      value: "true"
    - name: FF_WHATSAPP_BYOT
      value: "false"
  
  livenessProbe:
    httpGet:
      path: /api/health
      port: http
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3
  
  readinessProbe:
    httpGet:
      path: /api/health
      port: http
    initialDelaySeconds: 5
    periodSeconds: 5
    timeoutSeconds: 3
    failureThreshold: 3

# AI Service configuration
aiService:
  enabled: true
  image:
    registry: phx.ocir.io
    repository: axkw6whnjncs/ai-service
    tag: "2026.01.31.56"
    pullPolicy: IfNotPresent
  replicaCount: 1
  
  service:
    type: ClusterIP
    port: 8010
    targetPort: 8010
  
  resources:
    limits:
      cpu: 300m
      memory: 256Mi
    requests:
      cpu: 100m
      memory: 128Mi
  
  env:
    - name: AI_SERVICE_ENABLED
      value: "true"
    - name: AI_PROVIDER
      value: "google_ai_studio"
    - name: GOOGLE_AI_STUDIO_API_KEY
      valueFrom:
        secretKeyRef:
          name: ai-service-secrets
          key: google-ai-studio-api-key
    - name: DAILY_REQUEST_LIMIT
      value: "500"
    - name: MIN_CONFIDENCE_THRESHOLD
      value: "0.7"
    - name: LOG_LEVEL
      value: "INFO"
    - name: BACKEND_CALLBACK_URL
      value: "http://cricket-feedback-backend-service:5001"
  
  livenessProbe:
    httpGet:
      path: /health
      port: http
    initialDelaySeconds: 10
    periodSeconds: 30
    timeoutSeconds: 5
    failureThreshold: 3
  
  readinessProbe:
    httpGet:
      path: /health
      port: http
    initialDelaySeconds: 5
    periodSeconds: 10
    timeoutSeconds: 3
    failureThreshold: 3

# Frontend configuration
frontend:
  enabled: true
  image:
    registry: phx.ocir.io/axkw6whnjncs
    repository: cricket-feedback-frontend
    tag: "2026.01.31.56"
  replicaCount: 1
  
  service:
    type: ClusterIP
    port: 80
    targetPort: 80
  
  resources:
    limits:
      cpu: 200m
      memory: 256Mi
    requests:
      cpu: 100m
      memory: 128Mi
  
  env:
    - name: REACT_APP_API_URL
      value: "https://app.cricsmart.in/api"
    - name: REACT_APP_GOOGLE_CLIENT_ID
      valueFrom:
        secretKeyRef:
          name: cricket-secrets
          key: google-client-id


# ============================================
# MongoDB Configuration
# ============================================
# This is the DEFAULT configuration for in-cluster MongoDB.
# 
# DEPLOYMENT OPTIONS:
#   1. MongoDB Atlas (Cloud) - RECOMMENDED for prod/dev:
#      - Set mongodb.enabled: false in values-production.yaml or values-development.yaml
#      - Store Atlas URI in cricket-secrets -> mongodb-uri
#      - URI format: mongodb+srv://user:pass@cluster.mongodb.net/database?retryWrites=true&w=majority
#
#   2. In-Cluster MongoDB - For local development:
#      - Use values-local.yaml which sets mongodb.enabled: true
#      - MongoDB deployed as a pod in the cluster
#      - URI format: mongodb://admin:password123@cricket-feedback-mongodb:27017/cricket-feedback?authSource=admin
#
# The mongodb-uri in cricket-secrets takes precedence regardless of this setting.
# ============================================
mongodb:
  enabled: true  # Set to false in prod/dev values files to use Atlas
  auth:
    enabled: true
    rootUser: admin
    rootPassword: "password123"
    username: admin
    password: "password123"
    database: cricket-feedback
  
  architecture: standalone
  replicaCount: 1
  
  persistence:
    enabled: true
    storageClass: "oci-bv"
    size: 50Gi
    annotations:
      # Prevent automatic deletion when namespace is deleted
      "helm.sh/resource-policy": keep
    accessModes:
      - ReadWriteOnce
    # Retain data even if PVC is deleted
    persistentVolumeReclaimPolicy: Retain
  
  resources:
    limits:
      cpu: 500m
      memory: 512Mi
    requests:
      cpu: 250m
      memory: 256Mi

# Ingress configuration
ingress:
  enabled: true
  className: "nginx"
  annotations:
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    cert-manager.io/cluster-issuer: "letsencrypt-prod"
  
  # Primary domain (new)
  host: app.cricsmart.in
  # Legacy domain (keep for backward compatibility during migration)
  secondaryHost: mavericks11.duckdns.org
  # Additional custom domains
  additionalHosts:
    - cricsmart.in
    - www.cricsmart.in
  tls:
    enabled: true
    secretName: cricket-feedback-tls

# Secrets configuration
secrets:
  enabled: false
  jwtSecret: "CHANGE_ME_JWT"
  googleClientId: "CHANGE_ME_GOOGLE_CLIENT_ID"
  googleClientSecret: "CHANGE_ME_GOOGLE_CLIENT_SECRET"
  superAdminKey: "CHANGE_ME_SUPER_ADMIN_KEY"
  whatsappAccessToken: "CHANGE_ME_WHATSAPP_TOKEN"
  googleAIStudioAPIKey: "CHANGE_ME_GOOGLE_AI_STUDIO_API_KEY"

# Namespace configuration
namespace:
  create: true
  name: cricket-feedback

# Service account configuration
serviceAccount:
  create: true
  name: cricket-feedback
  annotations: {}

# Autoscaling configuration
autoscaling:
  enabled: false
  backend:
    minReplicas: 1
    maxReplicas: 5
    targetCPUUtilizationPercentage: 70
  frontend:
    minReplicas: 1
    maxReplicas: 3
    targetCPUUtilizationPercentage: 70
